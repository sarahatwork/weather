"use strict";angular.module("weatherApp",["ngAnimate","ngCookies","ngRoute","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/weather.html",controller:"WeatherCtrl"}).when("/cities/:id",{templateUrl:"views/city-detail.html",controller:"CityDetailCtrl"})}]),angular.module("weatherApp").controller("WeatherCtrl",["weather",function(a){var b=this;this.query="Jersey City",this.showForm=!1,this.cities=[],this.columns=3,this.colSpan=12/this.columns,this.cityRows=[],this.roomForButton=!0,this.search=function(){a.getCityByQuery(b.query,function(a){b.query="",b.showForm=!1,b.cities=a,b.organizeRows()})},this.organizeRows=function(){var a=[];b.cityRows=[];var c=b.columns-1,d=b.cities.length;b.cities.forEach(function(e,f){var g=f%b.columns;a.push(e),(g===c||f==d-1)&&(b.cityRows.push(a),a=[])});var e=b.cityRows[b.cityRows.length-1];this.roomForButton=e&&e.length<b.columns},this.toggleForm=function(){b.showForm=!b.showForm},this.search()}]),angular.module("weatherApp").service("weather",["$http","$cookies",function(a,b){var c=this;this.cityIds=b.cityIds&&angular.fromJson(b.cityIds)||[],this.cityQueries=b.cityQueries&&angular.fromJson(b.cityQueries)||{},this.imgFor=function(a){return"http://l.yimg.com/a/i/us/we/52/"+a+".gif"},this.search=function(d,e){var f="https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20weather.forecast%20where%20woeid%20in%20(select%20woeid%20from%20geo.places(1)%20where%20text%3D%22"+d+"%22)&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys";a.get(f).then(function(a){console.log("i just made a request for "+d);var f=a.data.query.results.channel,g={};g.name=f.location.city,g.state=f.location.region,g.id=f.item.guid.content,g.temp=f.item.condition.temp,g.text=f.item.condition.text,g.img=c.imgFor(f.item.condition.code),g.forecast=f.item.forecast.map(function(a){return a.img=c.imgFor(a.code),a}),-1===c.cityIds.indexOf(g.id)&&c.cityIds.push(g.id),c.cityQueries[d]||(c.cityQueries[d]=g.id),b.cityIds=angular.toJson(c.cityIds),b.cityQueries=angular.toJson(c.cityQueries),b[g.id]||(b[g.id]=angular.toJson(g)),e(c.cityData())})},this.cityData=function(){return c.cityIds.map(function(a){return angular.fromJson(b[a])})},this.getCityByQuery=function(a,b){c.cityQueries[a]?b(c.cityData()):c.search(a,b)},this.getCityByKey=function(a,c){c(angular.fromJson(b[a]))}}]),angular.module("weatherApp").directive("citySummary",function(){return{templateUrl:"views/city-summary.html",restrict:"A",scope:{city:"="}}}),angular.module("weatherApp").directive("addCity",function(){return{templateUrl:"views/new-city.html",restrict:"A",scope:!0}}),angular.module("weatherApp").controller("CityDetailCtrl",["weather","$routeParams",function(a,b){var c=this;this.city={},a.getCityByKey(b.id,function(a){c.city=a})}]);