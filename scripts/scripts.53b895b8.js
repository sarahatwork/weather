"use strict";angular.module("weatherApp",["ngAnimate","ngCookies","ngRoute","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/weather.html",controller:"WeatherCtrl"}).when("/cities/:id",{templateUrl:"views/city-detail.html",controller:"CityDetailCtrl"})}]),angular.module("weatherApp").controller("WeatherCtrl",["weather",function(a){var b=this;this.query="Jersey City",this.showForm=!1,this.cities=[],this.columns=2,this.cityRows=[],this.roomForButton=!0,this.colSpan=function(){return 12/b.columns},this.search=function(){a.getCityByQuery(b.query,function(a){b.query="",b.showForm=!1,b.cities=a,b.organizeRows()})},this.organizeRows=function(){var a=[];b.cityRows=[];var c=b.columns-1,d=b.cities.length;b.cities.forEach(function(e,f){var g=f%b.columns;a.push(e),(g===c||f==d-1)&&(b.cityRows.push(a),a=[])});var e=b.cityRows[b.cityRows.length-1];this.roomForButton=e&&e.length<b.columns},this.toggleForm=function(){b.showForm=!b.showForm},this.search()}]),angular.module("weatherApp").filter("urlEncode",function(){return window.encodeURIComponent}),angular.module("weatherApp").service("weather",["$http","$cookies","urlEncodeFilter",function(a,b,c){var d=this;this.cityIds=b.cityIds&&angular.fromJson(b.cityIds)||[],this.cityQueries=b.cityQueries&&angular.fromJson(b.cityQueries)||{},this.imgFor=function(a){return"http://l.yimg.com/a/i/us/we/52/"+a+".gif"},this.search=function(e,f){var g='select * from weather.forecast where woeid in (select woeid from geo.places(1) where text="'+e+'")',h="https://query.yahooapis.com/v1/public/yql?q="+c(g)+"&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys";a.get(h).then(function(a){console.log("i just made a request for "+e);var c=a.data.query.results.channel,g={};g.name=c.location.city,g.state=c.location.region,g.id=c.item.guid.content,g.temp=c.item.condition.temp,g.text=c.item.condition.text,g.img=d.imgFor(c.item.condition.code),g.forecast=c.item.forecast.map(function(a){return a.img=d.imgFor(a.code),a}),g.feelsLike=c.wind.chill,g.windSpeed=c.wind.speed,g.humidity=c.atmosphere.humidity,g.visibility=c.atmosphere.visibility,g.sunrise=c.astronomy.sunrise,g.sunset=c.astronomy.sunset,-1===d.cityIds.indexOf(g.id)&&d.cityIds.push(g.id),d.cityQueries[e]||(d.cityQueries[e]=g.id),b.cityIds=angular.toJson(d.cityIds),b.cityQueries=angular.toJson(d.cityQueries),b[g.id]||(b[g.id]=angular.toJson(g)),f(d.cityData())})},this.cityData=function(){return d.cityIds.map(function(a){return angular.fromJson(b[a])})},this.getCityByQuery=function(a,b){d.cityQueries[a]?b(d.cityData()):d.search(a,b)},this.getCityByKey=function(a,c){c(angular.fromJson(b[a]))}}]),angular.module("weatherApp").directive("citySummary",function(){return{templateUrl:"views/city-summary.html",restrict:"A",scope:{city:"="}}}),angular.module("weatherApp").directive("addCity",function(){return{templateUrl:"views/new-city.html",restrict:"A",scope:!0}}),angular.module("weatherApp").controller("CityDetailCtrl",["weather","$routeParams",function(a,b){var c=this;this.city={},a.getCityByKey(b.id,function(a){c.city=a})}]);